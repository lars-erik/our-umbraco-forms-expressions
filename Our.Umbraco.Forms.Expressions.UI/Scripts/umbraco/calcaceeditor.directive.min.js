(function(){"use strict";function n(n){function i(i,r,u,f){var s=n.ace||{},o=angular.extend({},s,i.$eval(u.umbAceEditor)),e=window.ace.edit(r[0]),a;e.$blockScrolling=Infinity;var h=e.getSession(),c,l,v=function(){var n=arguments[0],t=Array.prototype.slice.call(arguments,1);if(angular.isDefined(n))if(angular.isFunction(n))n(t);else throw new Error("ui-ace use a function as callback.");},y={onChange:function(n){return function(t){var r=h.getValue();!f||r===f.$viewValue||i.$$phase||i.$root.$$phase||f.$setViewValue(r);v(n,t,e)}},onBlur:function(n){return function(){v(n,e)}}};u.$observe("readonly",function(n){e.setReadOnly(!!n||n==="")});f&&(f.$formatters.push(function(n){if(angular.isUndefined(n)||n===null)return"";if(angular.isObject(n)||angular.isArray(n))throw new Error("ui-ace cannot use an object or an array as a model");return n}),f.$render=function(){h.setValue(f.$viewValue)});a=function(n,r){if(n!==r){o=angular.extend({},s,i.$eval(u.calcAceEditor));o.callbacks=[o.onLoad];o.onLoad!==s.onLoad&&o.callbacks.unshift(s.onLoad);h.removeListener("change",c);c=y.onChange(o.onChange);h.on("change",c);e.removeListener("blur",l);l=y.onBlur(o.onBlur);e.on("blur",l);t(e,h,o)}};i.$watch(u.umbAceEditor,a,!0);a(s);r.on("$destroy",function(){e.session.$stopWorker();e.destroy()});i.$watch(function(){return[r[0].offsetWidth,r[0].offsetHeight]},function(){e.resize();e.renderer.updateFull()},!0);i.editor=e}function r(n,t,r,u){i(n,t,r,u)}var t;if(angular.isUndefined(window.ace))throw new Error("ui-ace need ace to work... (o rly?)");return t=function(n,t,i){var f,r,u;if(angular.isDefined(i.workerPath)&&(f=window.ace.require("ace/config"),f.set("workerPath",i.workerPath)),angular.isDefined(i.require)&&i.require.forEach(function(n){window.ace.require(n)}),angular.isDefined(i.showGutter)&&n.renderer.setShowGutter(i.showGutter),angular.isDefined(i.useWrapMode)&&t.setUseWrapMode(i.useWrapMode),angular.isDefined(i.showInvisibles)&&n.renderer.setShowInvisibles(i.showInvisibles),angular.isDefined(i.showIndentGuides)&&n.renderer.setDisplayIndentGuides(i.showIndentGuides),angular.isDefined(i.useSoftTabs)&&t.setUseSoftTabs(i.useSoftTabs),angular.isDefined(i.showPrintMargin)&&n.setShowPrintMargin(i.showPrintMargin),angular.isDefined(i.disableSearch)&&i.disableSearch&&n.commands.addCommands([{name:"unfind",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:function(){return!1},readOnly:!0}]),angular.isString(i.theme)&&n.setTheme("ace/theme/"+i.theme),angular.isString(i.mode)&&t.setMode("ace/mode/"+i.mode),angular.isDefined(i.firstLineNumber)&&(angular.isNumber(i.firstLineNumber)?t.setOption("firstLineNumber",i.firstLineNumber):angular.isFunction(i.firstLineNumber)&&t.setOption("firstLineNumber",i.firstLineNumber())),angular.isDefined(i.advanced))for(r in i.advanced)u={name:r,value:i.advanced[r]},n.setOption(u.name,u.value);if(angular.isDefined(i.rendererOptions))for(r in i.rendererOptions)u={name:r,value:i.rendererOptions[r]},n.renderer.setOption(u.name,u.value);angular.forEach(i.callbacks,function(t){angular.isFunction(t)&&t(n)})},{restrict:"EA",require:"?ngModel",link:r}}angular.module("umbraco.directives").constant("calcAceEditorConfig",{}).directive("calcAceEditor",["calcAceEditorConfig","assetsService",n])})();